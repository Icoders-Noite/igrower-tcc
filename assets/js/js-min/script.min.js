"use strict";var ssid,senha,minHumidity,autoMode,hostApi="https://us-central1-meu-tcc-1995.cloudfunctions.net/function-1";function callback(e){e.status?(localStorage.setItem("id",e.id_user),window.location.href="dashboard.html"):$("#credenciaisIncorretas").fadeIn("slow")}function callbackCadastro(e){e.status?(alert("Cadastrado com sucesso!"),window.location.href="gerar-configuracoes.html"):"E-mail já cadastrado!"==e.mensagem?emailCadastrado():alert(e.mensagem)}function emailCadastrado(){$("#emailExistente").fadeIn("slow",function(){})}$("#btn-login").click(function(){$("#credenciaisIncorretas").fadeOut("fast",function(){$("#camposEmBranco").fadeOut("fast",function(){var e,t=document.getElementById("email").value,a=document.getElementById("senha").value;0<t.length&&0<a.length?(e={email:t,senha:btoa(a)},$.ajax({url:hostApi+"/user-login",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json"},method:"POST",type:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){console.log(e),callback(e)}})):$("#camposEmBranco").fadeIn("slow")})})}),$("#senha").on("keypress",function(e){13==e.which&&$("#btn-login").trigger("click")}),$("#abrirCadastro").click(function(){$("#login").fadeOut("slow",function(){$("#cadastro").fadeIn("slow")}),document.title="Cadastro"}),$("#voltarLogin").click(function(){$("#cadastro").fadeOut("slow",function(){$("#login").fadeIn("slow")}),document.title="Login"}),$("#btn-cadastro").click(function(){$("#dadosNaoPreenchidos").fadeOut("fast",function(){$("#emailExistente").fadeOut("fast",function(){$("#emailExistente").fadeOut("fast",function(){$("#senhaCurta").fadeOut("fast",function(){$("#senhasDivergentes").fadeOut("fast",function(){var e,t=document.getElementById("emailCadastro").value,a=document.getElementById("nome").value,n=document.getElementById("sobrenome").value,o=document.getElementById("senhaCadastro").value,i=document.getElementById("confirmarSenha").value;0<t.length&&0<a.length&&0<n.length&&0<o.length&&0<i.length?8<=o.length?o==i?(e={nome:a,sobrenome:n,email:t,senha:btoa(o)},$.ajax({url:hostApi+"/novo-usuario",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json"},method:"POST",type:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){console.log("succes: "+e.status),callbackCadastro(e)}})):$("#senhasDivergentes").fadeIn("slow",function(){}):$("#senhaCurta").fadeIn("slow",function(){}):$("#dadosNaoPreenchidos").fadeIn("slow",function(){})})})})})})});var idArduino=-1;function ArquivoGerar(e){0<senha.length&&0<ssid.length&&"-1"!=minHumidity&&"0"!=minHumidity&&"-1"!=autoMode?(alert("Salve o arquivo de configurações dentro do cartão SD do Igrower e selecione para substituir arquivo"),salvar("".concat(e,"\n").concat(ssid,"\n").concat(senha,"\n"))):alert("Opções inválidas")}function salvar(e){var t=new Blob(Array.from(e),{type:"text/plain;charset=utf-8"});saveAs(t,"CONFIG.txt")}$("#btn-gerar-config").click(function(){ssid=$("#ssid").val(),senha=$("#senhaWifi").val(),minHumidity=$("#minHumidity").children("option:selected").val(),autoMode=$("#autoMode").children("option:selected").val(),idArduino=$("#idArduino").val();var e={user_Id:localStorage.getItem("id"),minHumidity:minHumidity,autoMode:autoMode,id_arduino:idArduino};console.log(e),$.ajax({url:"https://my-json-server.typicode.com/Icoders-Noite/api-fake-test/config",data:e,error:function(){alert("Ocorreu um error ao se conectar com a API")},dataType:"json",success:function(){ArquivoGerar(idArduino)},type:"GET"})}),$("#minHumidity").change(function(){"-1"==$(this).children("option:selected").val()&&$("#minHumidityManual").fadeIn("slow")}).trigger("change");var adicionouItens=!1;function salvarIdEmcache(){}function loadConfig(){$("#configArduino").html('<iframe id="iframeConfig" src="gerar-configuracoes.html"></iframe>')}function chartDough(e,t,a){var n=document.getElementById(t).getContext("2d"),o=switchCorUmidadeAr(e),i=100-e,r={elements:{center:{text:"Umidade Solo: ".concat(e,"%"),color:o,fontStyle:"Arial",sidePadding:20,minFontSize:20,lineHeight:25},legend:{display:!1}}},d={labels:[a],datasets:[{data:[e,i],backgroundColor:[o,"rgba(242, 242, 242,0.2)"],borderColor:["rgba(255, 99, 132, 1)"],borderWidth:0}]};Chart.defaults.global.legend.display=!1,Chart.defaults.global.tooltips.enabled=!1;var s=new Chart(n,{type:"doughnut",data:d,options:r});Chart.pluginService.register({beforeDraw:function(e){if(e.config.options.elements.center){var t=e.chart.ctx,a=e.config.options.elements.center,n=a.fontStyle||"Arial",o=a.text,i=a.color||"#000",r=a.maxFontSize||75,d=(a.sidePadding||20)/100*(2*e.innerRadius);t.font="30px "+n;var s=t.measureText(o).width,l=2*e.innerRadius-d,c=l/s,u=Math.floor(30*c),f=2*e.innerRadius,m=Math.min(u,f,r),g=a.minFontSize,h=a.lineHeight||25,v=!1;void 0===g&&(g=20),g&&m<g&&(m=g,v=!0),t.textAlign="center",t.textBaseline="middle";var p=(e.chartArea.left+e.chartArea.right)/2,$=(e.chartArea.top+e.chartArea.bottom)/2;if(t.font=m+"px "+n,t.fillStyle=i,!v)return void t.fillText(o,p,$);for(var y=o.split(" "),b="",w=[],C=0;C<y.length;C++)var A=b+y[C]+" ",b=l<t.measureText(A).width&&0<C?(w.push(b),y[C]+" "):A;$-=w.length/2*h;for(C=0;C<w.length;C++)t.fillText(w[C],p,$),$+=h;t.fillText(b,p,$)}}}),s.update()}function switchCorUmidadeAr(e){return e<=40?"rgba(252,30,68,0.8)":40<e&&e<50?"rgba(255, 237, 71,0.8)":"rgba(90, 255, 71,0.8)"}function switchCorUmidadeSolo(e){return e<=40?"rgba(252,30,68,0.8)":40<e&&e<50?"rgba(255, 237, 71,0.8)":"rgba(90, 255, 71,0.8)"}$("#minHumidityManual").change("mousestop",function(){adicionouItens&&$("#itemAdicionado").remove();var e=$("#minHumidityManual").val(),t="".concat(e,"%");$("#minHumidity").append(new Option(t,e)),$("#minHumidity").children(":last-child").attr("id","itemAdicionado").attr("selected","selected"),adicionouItens=!0}),$(window).on("load",function(){$("#preloader .inner").fadeOut(),$("#preloader").delay(350).fadeOut("slow"),$("body").delay(350).css({overflow:"visible"}),chartDough(80,"graficos-dashboard","Umidade - Solo")}),$("#abrirConfig").click(function(){loadConfig()});