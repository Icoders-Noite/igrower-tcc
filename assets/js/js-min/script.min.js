"use strict";var ssid,senha,minHumidity,autoMode,hostApi="https://us-central1-meu-tcc-1995.cloudfunctions.net/function-1";function callback(e){e.status?(localStorage.setItem("id",e.id_user),window.location.href="dashboard.html"):$("#credenciaisIncorretas").fadeIn("slow")}function callbackCadastro(e){e.status?(alert("Cadastrado com sucesso!"),window.location.href="gerar-configuracoes.html"):"E-mail já cadastrado!"==e.mensagem?emailCadastrado():alert(e.mensagem)}function emailCadastrado(){$("#emailExistente").fadeIn("slow",function(){})}$("#btn-login").click(function(){$("#credenciaisIncorretas").fadeOut("fast",function(){$("#camposEmBranco").fadeOut("fast",function(){var e,t=document.getElementById("email").value,a=document.getElementById("senha").value;0<t.length&&0<a.length?(e={email:t,senha:btoa(a)},$.ajax({url:hostApi+"/user-login",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json"},method:"POST",type:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){console.log(e),callback(e)}})):$("#camposEmBranco").fadeIn("slow")})})}),$("#senha").on("keypress",function(e){13==e.which&&$("#btn-login").trigger("click")}),$("#abrirCadastro").click(function(){$("#login").fadeOut("slow",function(){$("#cadastro").fadeIn("slow")}),document.title="Cadastro"}),$("#voltarLogin").click(function(){$("#cadastro").fadeOut("slow",function(){$("#login").fadeIn("slow")}),document.title="Login"}),$("#btn-cadastro").click(function(){$("#dadosNaoPreenchidos").fadeOut("fast",function(){$("#emailExistente").fadeOut("fast",function(){$("#emailExistente").fadeOut("fast",function(){$("#senhaCurta").fadeOut("fast",function(){$("#senhasDivergentes").fadeOut("fast",function(){var e,t=document.getElementById("emailCadastro").value,a=document.getElementById("nome").value,o=document.getElementById("sobrenome").value,n=document.getElementById("senhaCadastro").value,i=document.getElementById("confirmarSenha").value;0<t.length&&0<a.length&&0<o.length&&0<n.length&&0<i.length?8<=n.length?n==i?(e={nome:a,sobrenome:o,email:t,senha:btoa(n)},$.ajax({url:hostApi+"/novo-usuario",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json"},method:"POST",type:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){console.log("succes: "+e.status),callbackCadastro(e)}})):$("#senhasDivergentes").fadeIn("slow",function(){}):$("#senhaCurta").fadeIn("slow",function(){}):$("#dadosNaoPreenchidos").fadeIn("slow",function(){})})})})})})});var idArduino=-1;function ArquivoGerar(e){0<senha.length&&0<ssid.length&&"-1"!=minHumidity&&"0"!=minHumidity&&"-1"!=autoMode?(alert("Salve o arquivo de configurações dentro do cartão SD do Igrower e selecione para substituir arquivo"),salvar("".concat(e,"\n").concat(ssid,"\n").concat(senha,"\n"))):alert("Opções inválidas")}function salvar(e){var t=new Blob(Array.from(e),{type:"text/plain;charset=utf-8"});saveAs(t,"CONFIG.txt")}$("#btn-gerar-config").click(function(){ssid=$("#ssid").val(),senha=$("#senhaWifi").val(),minHumidity=$("#minHumidity").children("option:selected").val(),autoMode=$("#autoMode").children("option:selected").val(),idArduino=$("#idArduino").val();var e={user_Id:localStorage.getItem("id"),minHumidity:minHumidity,autoMode:autoMode,id_arduino:idArduino};console.log(e),$.ajax({url:"https://my-json-server.typicode.com/Icoders-Noite/api-fake-test/config",data:e,error:function(){alert("Ocorreu um error ao se conectar com a API")},dataType:"json",success:function(){ArquivoGerar(idArduino)},type:"GET"})}),$("#minHumidity").change(function(){"-1"==$(this).children("option:selected").val()&&$("#minHumidityManual").fadeIn("slow")}).trigger("change");var adicionouItens=!1;function salvarIdEmcache(){}function getSensores(){var e={id_user:localStorage.getItem("id")};$.ajax({url:hostApi+"/get-status-sensores",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Content-Type":"application/json"},method:"POST",type:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){console.log(e),fillCharts(e)}})}function fillCharts(e){var t=e.resultado[0];chartDough(t.umidade_solo,"graficos-solo-dashboard","Umidade - Solo","Solo"),chartDough(t.umidade_ar,"graficos-ar-dashboard","Umidade - Ar","Ar"),chartTemperatureDough(t.temperatura,"graficos-temperatura-dashboard")}function loadConfig(){$("#configArduino").html('<iframe id="iframeConfig" src="gerar-configuracoes.html"></iframe>')}function chartDough(e,t,a,o){var n,i=document.getElementById(t).getContext("2d");n=("Solo"==o?switchCorUmidadeSolo:switchCorUmidadeAr)(e);var r=100-e,s={responsive:!0,maintainAspectRatio:!1,elements:{center:{text:"Umidade ".concat(o,": ").concat(e,"%"),color:n,fontStyle:"Arial",sidePadding:20,minFontSize:20,lineHeight:25},legend:{display:!1}}},l={labels:[a],datasets:[{data:[e,r],backgroundColor:[n,"rgba(242, 242, 242,0.2)"],borderColor:["rgba(255, 99, 132, 1)"],borderWidth:0}]};Chart.defaults.global.legend.display=!1,Chart.defaults.global.tooltips.enabled=!1,Chart.defaults.global.plugins.datalabels.display=!1;var d=new Chart(i,{type:"doughnut",data:l,options:s});Chart.pluginService.register({beforeDraw:function(e){if(e.config.options.elements.center){var t=e.chart.ctx,a=e.config.options.elements.center,o=a.fontStyle||"Arial",n=a.text,i=a.color||"#000",r=a.maxFontSize||75,s=(a.sidePadding||20)/100*(2*e.innerRadius);t.font="30px "+o;var l=t.measureText(n).width,d=2*e.innerRadius-s,c=d/l,u=Math.floor(30*c),f=2*e.innerRadius,g=Math.min(u,f,r),m=a.minFontSize,h=a.lineHeight||25,p=!1;void 0===m&&(m=20),m&&g<m&&(g=m,p=!0),t.textAlign="center",t.textBaseline="middle";var y=(e.chartArea.left+e.chartArea.right)/2,v=(e.chartArea.top+e.chartArea.bottom)/2;if(t.font=g+"px "+o,t.fillStyle=i,!p)return void t.fillText(n,y,v);for(var b=n.split(" "),C="",$=[],w=0;w<b.length;w++)var A=C+b[w]+" ",C=d<t.measureText(A).width&&0<w?($.push(C),b[w]+" "):A;v-=$.length/2*h;for(w=0;w<$.length;w++)t.fillText($[w],y,v),v+=h;t.fillText(C,y,v)}}}),d.update()}function chartTemperatureDough(e,t){var a=document.getElementById(t);new Chart(a,{type:"horizontalBar",data:{labels:[],datasets:[{data:[e],backgroundColor:switchCorTemperatura(e),datalabels:{color:"white"}},{data:[45-e],backgroundColor:"lightgrey",hoverBackgroundColor:"lightgrey",datalabels:{color:"lightgray"}}]},options:{responsive:!0,maintainAspectRatio:!1,legend:{display:!1},tooltips:{enabled:!1},scales:{xAxes:[{display:!1,stacked:!0}],yAxes:[{display:!1,stacked:!0}]},plugins:{datalabels:{display:!0,align:"start",anchor:"end",backgroundColor:null,borderColor:null,borderRadius:4,borderWidth:1,font:{size:20,weight:"bold"},offset:10,formatter:function(e,t){return t.chart.data.labels[t.dataIndex]}}}}})}function switchCorUmidadeAr(e){return e<=40?"rgba(252,30,68,0.8)":40<e&&e<50?"rgba(255, 237, 71,0.8)":"rgba(90, 255, 71,0.8)"}function switchCorUmidadeSolo(e){return e<=10?"rgba(199,80,107,0.8)":"rgba(0, 132, 184,0.8)"}function switchCorTemperatura(e){return e<=12?"rgba(0,0,255,0.8)":12<e&&e<24?"rgba(0,255,0,0.8)":"rgba(255,0,0,0.8)"}$("#minHumidityManual").change("mousestop",function(){adicionouItens&&$("#itemAdicionado").remove();var e=$("#minHumidityManual").val(),t="".concat(e,"%");$("#minHumidity").append(new Option(t,e)),$("#minHumidity").children(":last-child").attr("id","itemAdicionado").attr("selected","selected"),adicionouItens=!0}),$(window).on("load",function(){$("#preloader .inner").fadeOut(),$("#preloader").delay(350).fadeOut("slow"),$("body").delay(350).css({overflow:"visible"});window.setInterval(getSensores,6e4)}),$("#abrirConfig").click(function(){loadConfig()});